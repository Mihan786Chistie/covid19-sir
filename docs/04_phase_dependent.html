<!-- Refer to https://stackoverflow.com/a/50495306 -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phase-dependent SIR models &mdash; CovsirPhy  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scenario analysis" href="05_scenario_analysis.html" />
    <link rel="prev" title="SIR-derived ODE models" href="03_ode.html" />
<script type="text/javascript">
    window.onload = function () {
        string = document.body.innerHTML;
        string = string.replace(/ package/g, '').replace(/ module/g, '');
        document.body.innerHTML = string;
    }
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_logo_100.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.27.0-gamma
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">CovsirPhy introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown/INSTALLATION.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_data_preparation.html">Data preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_data_engineering.html">Data engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ode.html">SIR-derived ODE models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Phase-dependent SIR models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Dynamics-of-phase-dependent-SIR-models">1. Dynamics of phase-dependent SIR models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1-1.-Define-the-0th-phase">1-1. Define the 0th phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-2.-Define-the-1st-phase">1-2. Define the 1st phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-3.-Track-ODE-parameter-values">1-3. Track ODE parameter values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-4.-Simulation">1-4. Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-5.-Observable-variables">1-5. Observable variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-S-R-change-point-analysis">2. S-R change point analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#2-1.-S-R-plane">2-1. S-R plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2-2.-log(S)-vs. R-plane">2-2. log(S) vs. R plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2-3.-Plane-of-phase-dependent-models">2-3. Plane of phase-dependent models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.4-Time-series-segmentation">2.4 Time-series segmentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-ODE-parameter-estimation">3. ODE parameter estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#3.1-Preparation">3.1 Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.2-Tau-estimation">3.2 Tau estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.3-ODE-parameter-estimation">3.3 ODE parameter estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-With-actual-data">4. With actual data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#4-1.-Data-preparation">4-1. Data preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-2.-Time-series-segmentation">4-2. Time-series segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-3.-Parameter-estimation">4-3. Parameter estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-4.-Accuracy-evaluation">4-4. Accuracy evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-5.-Simulation">4-5. Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-6.-Tracking-of-ODE-parameters">4-6. Tracking of ODE parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_scenario_analysis.html">Scenario analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_prediction.html">ODE parameter prediction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="covsirphy.html">covsirphy package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="markdown/TERM.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security policy of CovsirPhy</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contribution guideline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CovsirPhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Phase-dependent SIR models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><a class="reference external" href="https://mybinder.org/v2/gh/lisphilar/covid19-sir/HEAD?labpath=example%2F04_phase_dependent.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<div class="section" id="Phase-dependent-SIR-models">
<h1>Phase-dependent SIR models<a class="headerlink" href="#Phase-dependent-SIR-models" title="Permalink to this heading"></a></h1>
<p>SIR-derived ODE models (SIR, SIR-D, SIR-F) assume that ODE parameter values are always constant. Can we apply this assumption to real data?</p>
<p><a class="reference external" href="https://www.kaggle.com/code/lisphilar/covid-19-data-with-sir-model/notebook">Kaggle: COVID-19 data with SIR model</a> concluded this was No - ODE parameter values change with phases - because measures taken by people changed the situation of COVID-19 outbreak actually. Term “phase” means a sequential dates in which the parameters of SIR-derived models are constant. To remove fluctuations from analysis, “time-dependent” should be avoided.</p>
<hr class="docutils" />
<p>The first section will show the dynamics of phase-dependent SIR models with sample data.</p>
<p>The Kaggle notebook also suggested detailed steps of applying phase-dependent SIR models to actual data. The second section demonstrates how to divide actual time-series data to phases (time-series segmentation with “S-R change point analysis”). The third section is to estimate ODE parameter values of phases (“ODE parameter estimation”).</p>
<p>With fourth section, we will perform them with actual data of Tokyo/Japan as an example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">covsirphy</span> <span class="k">as</span> <span class="nn">cs</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="n">cs</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="section" id="1.-Dynamics-of-phase-dependent-SIR-models">
<h2>1. Dynamics of phase-dependent SIR models<a class="headerlink" href="#1.-Dynamics-of-phase-dependent-SIR-models" title="Permalink to this heading"></a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> class, we will simulate phase-dependent SIR model with sample data (two phase) as an example.</p>
<div class="line-block">
<div class="line">The 0th phase: 01Jan2022 - 28Feb2022, rho=0.2, sigma=0.075 (preset)</div>
<div class="line">The 1st phase: 01Mar2022 - 30Jun2022, <strong>rho=0.4</strong>, sigma=0.075</div>
</div>
<p>tau value: 1440 [min] (default)</p>
<div class="section" id="1-1.-Define-the-0th-phase">
<h3>1-1. Define the 0th phase<a class="headerlink" href="#1-1.-Define-the-0th-phase" title="Permalink to this heading"></a></h3>
<p>As the first step, define the 0th (initial) phase with preset ODE parameter values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1-2.-Define-the-1st-phase">
<h3>1-2. Define the 1st phase<a class="headerlink" href="#1-2.-Define-the-1st-phase" title="Permalink to this heading"></a></h3>
<p>Get the current settings of initial values of variables and ODE parameter values as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. Then, edit it and register it to the instance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">before_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">before_df</span>
</pre></div>
</div>
</div>
<p>Without NAs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">before_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Edit the dataframe to set the ODE parameter values of the 1st phase.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setting_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">setting_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">setting_df</span>
</pre></div>
</div>
</div>
<p>Without NAs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setting_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Register the new settings. Because initial values on 01Mar2022 will be calculated with analytical solution of the 0th phase, they were not registered manually.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">setting_df</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>High-lightened:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_max</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;1/beta [day]&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>With the same way, we can set additional phases, if necessary for your analysis.</p>
</div>
<div class="section" id="1-3.-Track-ODE-parameter-values">
<h3>1-3. Track ODE parameter values<a class="headerlink" href="#1-3.-Track-ODE-parameter-values" title="Permalink to this heading"></a></h3>
<p>Confirm the phase-dependent ODE parameter values and Rt (reproduction number) by plotting.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">track</span><span class="p">()</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sample data of </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">: phase-dependent Rt values&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Reproduction number&quot;</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;27Feb2022&quot;</span><span class="p">:</span> <span class="s2">&quot;02Mar2022&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_max</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;1/beta [day]&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1-4.-Simulation">
<h3>1-4. Simulation<a class="headerlink" href="#1-4.-Simulation" title="Permalink to this heading"></a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">Dynamics().simulate()</span></code>, simulate the phase-dependent ODE model with numerical analysis of each phase. Because we did not specify the initial values on the start date of the 1st phase, simulated values on the 1st phase’s start date will be used as the initial values of the 1st phase.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<p>When we need convert model-specific variables to model-free variables (Susceptible/Infected/Fatal/Recovered), we will set <code class="docutils literal notranslate"><span class="pre">model_specific=False</span></code> (default). SIR model cannot separate “Fatal” cases and “Recovered” cases into different groups. Please use SIR-D model or SIR-F model if the following role is not acceptable for your analysis.</p>
<ul class="simple">
<li><p>“Fatal” is always equal to 0</p></li>
<li><p>“Recovered” is equal to “Fatal or Recovered” of SIR model</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1-5.-Observable-variables">
<h3>1-5. Observable variables<a class="headerlink" href="#1-5.-Observable-variables" title="Permalink to this heading"></a></h3>
<p>Actually, observable variables are Population/Confirmed/Infected/Recovered. We can calculate Population and Confirmed as follows.</p>
<ul class="simple">
<li><p>Confirmed = Infected + Fatal + Recovered</p></li>
<li><p>Population = Susceptible + Confirmed</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">real_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">real_df</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_df</span><span class="p">[[</span><span class="s2">&quot;Infected&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">real_df</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_df</span><span class="p">[[</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">real_df</span> <span class="o">=</span> <span class="n">real_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">]]</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">real_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> with observable variables&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-S-R-change-point-analysis">
<h2>2. S-R change point analysis<a class="headerlink" href="#2.-S-R-change-point-analysis" title="Permalink to this heading"></a></h2>
<p>S-R change point analysis (S-R trend analysis) is a technique to find the change points of phases with actual time-series data.</p>
<div class="section" id="2-1.-S-R-plane">
<h3>2-1. S-R plane<a class="headerlink" href="#2-1.-S-R-plane" title="Permalink to this heading"></a></h3>
<p>Author of the Kaggle Notebook considered S-R plane. This idea (S-R plane) is from <a class="reference external" href="https://dc.etsu.edu/cgi/viewcontent.cgi?article=3102&amp;context=etd">Balkew, Teshome Mogessie, “The SIR Model When S(t) is a Multi-Exponential Function.” (2010).Electronic Theses and Dissertations.Paper 1747</a>. This is for simplest SIR model, but we can apply it to SIR-F model.</p>
<p>We will focus on the following equations of SIR-derived ODE models.</p>
<p><span class="math">\begin{align*}
& \frac{\mathrm{d}S}{\mathrm{d}T}= - \frac{\beta}{N} S I  \\
& \frac{\mathrm{d}R}{\mathrm{d}T}= \gamma I  \\
\end{align*}</span></p>
<p>When <span class="math notranslate nohighlight">\(I &gt; 0\)</span>, this leads to <span class="math">\begin{align*}
& \frac{\mathrm{d}S}{\mathrm{d}R}= - \frac{\beta}{N \gamma} S  \\
& \beta, \gamma, N: const.
\end{align*}</span></p>
<p>Because <span class="math notranslate nohighlight">\(S(0) = N\)</span>, <span class="math notranslate nohighlight">\(S\)</span> is a function of <span class="math notranslate nohighlight">\(R\)</span> as follows.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">)</span>
<span class="n">N</span><span class="p">,</span> <span class="n">R</span>  <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;N R&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\beta \gamma&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dS</span> <span class="o">=</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="n">sr</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">dsolve</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">dS</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="s2">&quot;separable&quot;</span><span class="p">,</span> <span class="n">ics</span><span class="o">=</span><span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">N</span><span class="p">})</span>
<span class="n">sr</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2-2.-log(S)-vs. R-plane">
<h3>2-2. log(S) vs. R plane<a class="headerlink" href="#2-2.-log(S)-vs. R-plane" title="Permalink to this heading"></a></h3>
<p>Then,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sympy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">lhs</span><span class="p">)),</span> <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">rhs</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<p>Where <span class="math notranslate nohighlight">\(a=\cfrac{\beta}{N \gamma} \ (&gt; 0)\)</span>, <span class="math">\begin{align*}
& \log S_{(R)} = - a R + \log N  \\
& N: const.
\end{align*}</span></p>
<p><span class="math notranslate nohighlight">\(\log S\)</span> decreases constantly with increase of <span class="math notranslate nohighlight">\(R\)</span>, when the records follow a SIR-derived model and the parameter values of the model are constant. Plot of <span class="math notranslate nohighlight">\((x, y) = (R, \log S)\)</span> shows a line.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="n">sirf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">from_sample</span><span class="p">()</span>
<span class="n">solved_df</span> <span class="o">=</span> <span class="n">sirf</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">sr_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">solved_df</span><span class="p">))</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">sr_df</span><span class="p">[</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">sr_df</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: logS - R plane (corr: </span><span class="si">{</span><span class="n">corr</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Initial values on the first date was set, but the summary shows just a phase with no set ODE parameter values.</p>
<div class="line-block">
<div class="line">Limitations:</div>
<div class="line">Because <span class="math notranslate nohighlight">\(a=\cfrac{\beta}{N \gamma}\)</span>, the changes of <span class="math notranslate nohighlight">\(\alpha_1\)</span> and <span class="math notranslate nohighlight">\(\alpha_2\)</span> of SIR-D/SIR-F model cannot be detected.</div>
</div>
</div>
<div class="section" id="2-3.-Plane-of-phase-dependent-models">
<h3>2-3. Plane of phase-dependent models<a class="headerlink" href="#2-3.-Plane-of-phase-dependent-models" title="Permalink to this heading"></a></h3>
<p>Correlation coefficient is about -1.0 when ODE parameter values are constant The slope of the line may change when the ODE parameter values are changed.</p>
<p>Sample data of phase-dependent SIR-F model is here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">))</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()[[</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span> <span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">parameters</span><span class="p">]]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Dynamics:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]],</span>
    <span class="n">color_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">},</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Phase-dependent </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: dynamics&quot;</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">bbox_loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot of <span class="math notranslate nohighlight">\((R, \log _{10} S)\)</span>: with vertical lines on change points (= start dates of phases 1st - last):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="c1"># Get (R, log10S)</span>
<span class="n">sr_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">())</span>
<span class="c1"># Plotting</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Phase-dependent </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: logS - R plane</span><span class="se">\n</span><span class="s2">with vertical lines on change points&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="n">sr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>With the plotting, we can confirm most of the change points (except for 5th - 6th: difficult because the change was for <span class="math notranslate nohighlight">\(\alpha_1\)</span>).</p>
</div>
<div class="section" id="2.4-Time-series-segmentation">
<h3>2.4 Time-series segmentation<a class="headerlink" href="#2.4-Time-series-segmentation" title="Permalink to this heading"></a></h3>
<p>The previous sub-sections demonstrated that change points of S-R trend suggest change points of phases. Here, we will detect the change points of S-R trend with <code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code> via <code class="docutils literal notranslate"><span class="pre">Dynamics.segment()</span></code>. They uses <a class="reference external" href="https://github.com/deepcharles/ruptures">ruptures library: change point detection in Python</a> for off-line change point detection.</p>
<p>We will prepare a dataset which has the 0th - 5th phase.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Simulation</span>
<span class="n">sim_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sim_df</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Prepared dataset with phases and </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Create an instance of <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> with the prepared data. Note that the instance does not know the change points of phases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sim_df</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample data&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">display</span><span class="p">(</span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code> performs S-R change point analysis (trend analysis) and show the trend on S-R plane. Dot lines are the change points of phases.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">algo</span></code> argument, we can select the algorithm and models to detect the change points from “Binseg-normal” (default), “Pelt-rbf”, “Binseg-rbf”, “BottomUp-rbf”, “BottomUp-normal”. Please refer to <a class="reference external" href="https://centre-borelli.github.io/ruptures-docs/">the documentation of ruptures library</a>.</p>
<p>Additionally, we can specify the minimum size of phases with argument <code class="docutils literal notranslate"><span class="pre">min_size=7</span></code> (as default, [days]).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">points</span><span class="p">,</span> <span class="n">fit_df</span> <span class="o">=</span> <span class="n">dyn_sim</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">algo</span><span class="o">=</span><span class="s2">&quot;Binseg-rbf&quot;</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># List of change points</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="c1"># Plotted values</span>
<span class="n">display</span><span class="p">(</span><span class="n">fit_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that detected phases are un-registered to the instance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>To perform time-series segmentation with S-R trend analysis, we will use <code class="docutils literal notranslate"><span class="pre">Dynamics().segment()</span></code>, which accepts all keyword arguments of <code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">algo</span><span class="o">=</span><span class="s2">&quot;Binseg-rbf&quot;</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>If we need to add new change points or over-write change points, we will use <code class="docutils literal notranslate"><span class="pre">Dynamics().segment(points=&lt;list&gt;,</span> <span class="pre">overwrite=&lt;bool&gt;)</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Over-write</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;01Jun2022&quot;</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Add</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;01May2022&quot;</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="3.-ODE-parameter-estimation">
<h2>3. ODE parameter estimation<a class="headerlink" href="#3.-ODE-parameter-estimation" title="Permalink to this heading"></a></h2>
<p>This section demonstrates how to estimate tau value (constant for all phases) and the ODE parameter values of phases.</p>
<div class="section" id="3.1-Preparation">
<h3>3.1 Preparation<a class="headerlink" href="#3.1-Preparation" title="Permalink to this heading"></a></h3>
<p>Create an <code class="docutils literal notranslate"><span class="pre">Dynamics()</span></code> instance which has a dataset with 6 phases (the 0th - 5th). The instance knows change points, but does not know tau value and ODE parameter values.</p>
<p>Create dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Simulation</span>
<span class="n">sim_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sim_df</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Prepared dataset with phases and </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Create <code class="docutils literal notranslate"><span class="pre">Dynamics()</span></code> instance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_est</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sim_df</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample data&quot;</span><span class="p">)</span>
<span class="n">dyn_est</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;15Mar2022&quot;</span><span class="p">])</span>
<span class="c1"># Show tau value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">tau</span> <span class="ow">or</span> <span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">display</span><span class="p">(</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.2-Tau-estimation">
<h3>3.2 Tau estimation<a class="headerlink" href="#3.2-Tau-estimation" title="Permalink to this heading"></a></h3>
<p>Before ODE parameter estimation, we need to select tau value [min]. Tau value is expected to be constant for all phases because tau value is a parameter used to convert actual time (with unit [min]) to time steps (without units) from divisors of 1440).</p>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_tau(metric=&quot;RMSLE&quot;,</span> <span class="pre">q=0.5,</span> <span class="pre">digits=None,</span> <span class="pre">n_jobs=None)</span></code> (as default) sets the best tau value for the registered data, estimating ODE parameters with quantiles.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p>metric (str): metric name for scoring when selecting best tau value</p></li>
<li><p>q (float): the quantiles to compute, values between (0, 1)</p></li>
<li><p>digits (int or None): effective digits of ODE parameter values or None (skip rounding)</p></li>
<li><p>n_jobs (int or None): the number of parallel jobs or None (CPU count)</p></li>
</ul>
<p>Metrics (selectable candidates of <code class="docutils literal notranslate"><span class="pre">metric</span></code>):</p>
<ul class="simple">
<li><p>ME: maximum residual error</p></li>
<li><p>MAE: mean absolute error</p></li>
<li><p>MSE: mean square error</p></li>
<li><p>MSLE: mean squared logarithmic error</p></li>
<li><p>MAPE: mean absolute percentage error</p></li>
<li><p>RMSE: root mean squared error</p></li>
<li><p>RMSLE: root mean squared logarithmic error</p></li>
<li><p>R2: the coefficient of determination</p></li>
</ul>
<p>For example, RMSLE score will be calculated with the following equation. <span class="math">\begin{align*}
\mathrm{RMSLE} = \sqrt{\cfrac{1}{n}\sum_{i=1}^{n}(log_{10}(A_{i} + 1) - log_{10}(P_{i} + 1))^2}
\end{align*}</span> Where <span class="math notranslate nohighlight">\(A\)</span> is the observed (actual) values, <span class="math notranslate nohighlight">\(P\)</span> is estimated (predicted) values. Variables are <span class="math notranslate nohighlight">\(S (i=1), I (i=2), R (i=3)\ \mathrm{and}\ F (i=n=4)\)</span> for SIR-F model. When RMSLE score is low, hyperparameter estimation is highly accurate. Please refer to external sites, including <a class="reference external" href="https://medium.com/analytics-vidhya/root-mean-square-log-error-rmse-vs-rmlse-935c6cc1802a">Medium: What’s the Difference Between RMSE and RMSLE?</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="s2">&quot;RMSLE&quot;</span>
<span class="n">tau</span><span class="p">,</span> <span class="n">score_df</span> <span class="o">=</span> <span class="n">dyn_est</span><span class="o">.</span><span class="n">estimate_tau</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">tau</span> <span class="ow">or</span> <span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">score_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tau estimation: </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> scores (selected tau: </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2"> [min])&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Tau value [min]&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.3-ODE-parameter-estimation">
<h3>3.3 ODE parameter estimation<a class="headerlink" href="#3.3-ODE-parameter-estimation" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params(metric=&quot;RMSLE&quot;,</span> <span class="pre">digits=None,</span> <span class="pre">n_jobs=None,</span> <span class="pre">**kwargs)</span></code> (as default) sets ODE parameter values optimized for the registered data with hyperparameter optimization using <a class="reference external" href="https://github.com/optuna/optuna">Optuna library</a>.</p>
<p>Arguments of <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params</span></code>:</p>
<ul class="simple">
<li><p>metric (str): metric name for scoring when optimizing ODE parameter values of phases</p></li>
<li><p>digits (int or None): effective digits of ODE parameter values or None (skip rounding)</p></li>
<li><p>n_jobs (int or None): the number of parallel jobs or None (CPU count)</p></li>
<li><p>**kwargs: keyword arguments of optimization</p>
<ul>
<li><p>quantiles (tuple(int, int)): quantiles to cut parameter range, like confidence interval, (0.1, 0.9) as default</p></li>
<li><p>timeout (int): timeout of optimization, 180 as default</p></li>
<li><p>timeout_iteration (int): timeout of one iteration, 1 as default</p></li>
<li><p>tail_n (int): the number of iterations to decide whether score did not change for the last iterations, 4 as default</p></li>
<li><p>allowance (tuple(float, float)): the allowance of the max predicted values, (0.99, 1.01) as default</p></li>
<li><p>pruner (str): kind of pruner (hyperband, median, threshold or percentile), “threshold” as default</p></li>
<li><p>upper (float): works for “threshold” pruner, intermediate score is larger than this value, it prunes, 0.5 as default</p></li>
<li><p>percentile (float): works for “Percentile” pruner, the best intermediate value is in the bottom percentile among trials, it prunes, 50 as default</p></li>
<li><p>constant_liar (bool): whether use constant liar to reduce search effort or not, False as default</p></li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">est_df</span> <span class="o">=</span> <span class="n">dyn_est</span><span class="o">.</span><span class="n">estimate_params</span><span class="p">()</span>
<span class="c1"># Show RMSLE scores pf phases</span>
<span class="n">est_df</span> <span class="o">=</span> <span class="n">est_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">est_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Start&quot;</span>
<span class="n">display</span><span class="p">(</span><span class="n">est_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_est</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="4.-With-actual-data">
<h2>4. With actual data<a class="headerlink" href="#4.-With-actual-data" title="Permalink to this heading"></a></h2>
<p>This section demonstrates how to divide actual time-series data with phases (“S-R change point analysis”) and to estimate ODE parameter values of phases (“ODE parameter estimation”).</p>
<div class="section" id="4-1.-Data-preparation">
<h3>4-1. Data preparation<a class="headerlink" href="#4-1.-Data-preparation" title="Permalink to this heading"></a></h3>
<p>Prepare actual prefecture-level time-series data in Japan for demonstration.</p>
<p>Download the dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">DataEngineer</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">databases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;japan&quot;</span><span class="p">,</span> <span class="s2">&quot;covid19dh&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<p>Data cleaning, transformation, subsetting, complement.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="n">actual_df</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Japan&quot;</span><span class="p">,),</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;SIRF&quot;</span><span class="p">,</span> <span class="n">complement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="n">actual_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Plotting: removed “Susceptible” from the figure because “Susceptible” &gt;&gt; max(“Infected”, “Infected”, “Recovered”).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">actual_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Actual data in Japan&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>With the data, create an instance of <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">actual_df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">)</span>
<span class="c1"># Show registered values</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">register</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4-2.-Time-series-segmentation">
<h3>4-2. Time-series segmentation<a class="headerlink" href="#4-2.-Time-series-segmentation" title="Permalink to this heading"></a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">Dynamics.segment()</span></code>, we will apply S-R change point analysis (trend analysis) to the prepared actual data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span><span class="o">.</span><span class="n">segment</span><span class="p">();</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4-3.-Parameter-estimation">
<h3>4-3. Parameter estimation<a class="headerlink" href="#4-3.-Parameter-estimation" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate(**kwargs)</span></code> performs <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_tau()</span></code> and <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params()</span></code> in order.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span><span class="o">.</span><span class="n">estimate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_act</span><span class="o">.</span><span class="n">tau</span> <span class="ow">or</span> <span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4-4.-Accuracy-evaluation">
<h3>4-4. Accuracy evaluation<a class="headerlink" href="#4-4.-Accuracy-evaluation" title="Permalink to this heading"></a></h3>
<p>Compare the simulated results and actual records, and evaluate the differences.</p>
<p>Arguments: - date_range (tuple of (str or pandas.Timestamp or None) or None): range of dates to evaluate or None (the first and the last date) - metric (str): metric to evaluate the difference, “RMSLE” as default - display (bool): whether display figure of comparison or not - kwargs: keyword arguments of <code class="docutils literal notranslate"><span class="pre">covsirphy.compare_plot()</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="s2">&quot;RMSLE&quot;</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4</span><span class="si">}</span><span class="s2"> (overall score for time-series segmentation, tau estimation and ODE parameter estimation)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4-5.-Simulation">
<h3>4-5. Simulation<a class="headerlink" href="#4-5.-Simulation" title="Permalink to this heading"></a></h3>
<p>Simulate the dynamics with the estimated parameter sets of phases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_df</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulated data in Tokyo/Japan&quot;</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn_act</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>When we need to simulate for the last 30 days, we can use <code class="docutils literal notranslate"><span class="pre">Dynamics().parse_days(days=-30,</span> <span class="pre">ref=&quot;last&quot;)</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">parse_days</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">end</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated: Japan, </span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">y_integer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>When we need to perform simulation for th 5th and 6th phase, We can use <code class="docutils literal notranslate"><span class="pre">Dynamics().parse_phases(phases=[&quot;5th&quot;,</span> <span class="pre">&quot;6th&quot;])</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">parse_phases</span><span class="p">(</span><span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;5th&quot;</span><span class="p">,</span> <span class="s2">&quot;6th&quot;</span><span class="p">])</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">end</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated: Japan, </span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">y_integer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4-6.-Tracking-of-ODE-parameters">
<h3>4-6. Tracking of ODE parameters<a class="headerlink" href="#4-6.-Tracking-of-ODE-parameters" title="Permalink to this heading"></a></h3>
<p>Track the estimated ODE parameter values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">track_df</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">track</span><span class="p">()</span>
<span class="n">track_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">track_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the history of ODE parameter values tracked with global `track_df`.</span>

<span class="sd">    Args:</span>
<span class="sd">        param_name (str): name of the parameter</span>
<span class="sd">        title (str or None): figure title or Nome (@param_name will be used)</span>
<span class="sd">        h (list/tuple[int/float] or None): list of y values of horizontal lines or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">track_df</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
        <span class="n">track_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">param_name</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Tracked </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span>
        <span class="n">math_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\alpha_1\)</span>:</div>
<div class="line">Enhancement of PCR tests suppressed the number of fatal cases before confirmation.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;alpha1 [-]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\kappa\)</span> and <span class="math notranslate nohighlight">\(1/\alpha_2\)</span>:</div>
<div class="line">Enhancement of medical system suppressed the number of fatal cases.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/alpha2 [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(1/\beta\)</span>:</div>
<div class="line">Contact rate was changed with emergency declaration in Tokyo.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/beta [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(1/\gamma\)</span>:</div>
<div class="line">Recovery period is not changed clearly at this time.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/gamma [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Reproduction number:</div>
<div class="line">Rt &gt; 1 means explosive outbreak.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tracked reproduction number&quot;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Thank you!</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03_ode.html" class="btn btn-neutral float-left" title="SIR-derived ODE models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_scenario_analysis.html" class="btn btn-neutral float-right" title="Scenario analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Hirokazu Takaya and CovsirPhy Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>